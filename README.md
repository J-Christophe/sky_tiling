# sky_tiling

## Requirements: ## 

0. Python 2.7
1. Argparse
2. Astropy (>1.3)
3. Healpy
4. Matplotlib
5. Numpy
6. Scipy

## Installation ##

1. The main ranked-tiling code is supposed to be used as a module. Thus the installation involves simply setting up the environment. This is done by the customized setup.py script. Running this code requires the following arguments:


  * --work      : The name of the working directory. The configuration script will be dumped here
  * --telescope : The name of the telescope. Currently only works for ATLAS, BlackGEM, Pan Starrs and ZTF. In future 
                  developments, this will work for any generic telesscopes with square FOV.
  * --site      : The site of the observatory. This is required for the "scheduler". Note required for finding ranked-tiles.
                  However, the argument still needs to be supplied (could be just a fake site name).
  * --extension : The file extension (png, pdf etc) of the plot of the tiles. Only required for the plotting method.
                  However, the argument still needs to be supplied (could be just a fake extension name).

Example commands:
python setup.py --work ~/RunDir/sky_tile_work --telescope BlackGEM --site None --timemag None --extension png
python setup.py --work ~/RunDir/sky_tile_work --telescope BlackGEM --site lasilla --timemag None --extension pdf
...
*NOTE: Currently the setup script has to be run from the repository itself.*

Running this should generate a config file in the work directory. The std output of the script is the environment variables that will need to be exported. Once that is done, the ranked-tiling methods will be available for use:

## Basic function calls ##
skymap_file = 'bayestar.fits.gz' ### GW sky Map

tileObj = rankedTilesGenerator.RankedTileGenerator(skymap_file, 'config.ini')

[ranked_tile_indices, ranked_tile_probs] = tileObj.getRankedTiles(resolution=256)

This generates the ranked tiles and their corresponding probability values.

To plot the tiles use the following method:
tileObj.plotTiles(ranked_tile_indices, ranked_tile_probs, FOV=2.7, tileEdges=True, CI=0.90, save=True)

where, we are plotting for the BlackGEM's FOV. If tileEdges is set to False then the boundary of the tiles will not be plotted. Only the tile centers will be kept. If FOV is not given, then note tile boundary will be plotted either. 'save' allows the plot to be saved using the extension provided in the config file (generated by the setup script). CI is the confidence interval.

## Tile-Pixel maps ##

A vital ingredient for the ranked tile generation is the tile-pixel map for a telescope. This allows rapid computation of the ranked tiles. Currently the repository contains tile-pixel maps for the four aforementioned telescopes. However, only resolution of nside=256 is available for all the telescopes. Higher resolution maps are larger, and we will provide them via other means. However, the users are welcome to generate their own tile pixel maps. We describe this below:

There is a script in the bin directory of the repository, called preComputeTiles.py. This script requires any arbitrary GW sky-map (surrogate map) and a predetermined tile file for the telescope (defined by the grid in the sky commensurate to the FOV of the telescope). This tile file will have the following format...

ID        ra_center         dec_center

0         25.00            -89.9

1         51.43            -88.36

2         102.86           -88.36

3         154.29           -88.36

4         205.71           -88.36


(Examples of such files can be found in the tile_center_files directory of the repository. In the future we will also provide codes to generate these files.)

Running the following command will generate the tile-pixel map:

python preComputeTiles.py --tileFile <name of tile file> --resolution <256/512/1024/etc> --map <surrogate sky-map> --outTag <output file name tag>






Other methods:


1.  searchedArea: Given a sky-map and the actual injection position, we can find 
                  the total searched area and the searched probability to reach 
                  to the source. The resolution of the sky-map can also be supplied.


2.  sourceTile:   Give the ranked tiles and the actual injection position, this 
                  method finds the source tile index. 
                  
3.  detectability:  Function - given the rank of the source tile, integrtion time 
                    per tile, the total observation time, the distance to the 
                    source and limiting magnitude - time data for the telescope, 
                    this function gives the detectiability of the source


